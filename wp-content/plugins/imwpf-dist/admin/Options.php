<?php
 namespace imwpf\admin; class Options { private static $instance = array(); private $name; private $options; private $isChange = false; private function __construct($name) { $this->init($name); } public function __destruct() { $this->save(); } public static function getInstance($name) { if (isset(self::$instance[$name])) { return self::$instance[$name]; } self::$instance[$name] = new self($name); return self::$instance[$name]; } public function init($name) { $this->name = $name; $this->options = get_option($name); if (!$this->options || !is_array($this->options)) { $this->options = array(); } } public function add($key, $value) { $this->options[$key] = $value; $this->isChange = true; } public function get($key) { return isset($this->options[$key]) ? $this->options[$key] : null; } public function delete($key) { if (!isset($this->options[$key])) { return ; } unset($this->option[$key]); $this->isChange = true; } public function save() { if (!$this->isChange) { return; } update_option($this->name, $this->options) or add_option($this->name, $this->options); } }