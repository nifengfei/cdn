<?php
 namespace imwpf\modules; class AntiSpam { protected $keywords = array(); public function addBlockLinkComment() { add_action('preprocess_comment', array($this, 'blockLinkComment'), 1); } public function addBlockNoneChinese() { add_action('preprocess_comment', array($this, 'blockNoneChinese'), 1); } public function addBlockSomeKeywords($keywords) { $this->setKeywords($keywords); add_action('preprocess_comment', array($this, 'blockSomeKeywords'), 1); } public function blockLinkComment($comment) { if (in_array($comment['comment_type'], array('pingback', 'trackback'))) { return $comment; } if (preg_match("#(http|https)://[a-z]*#is", $comment["comment_content"])) { wp_die("评论内容不合法！"); } return $comment; } public function blockNoneChinese($comment) { if (in_array($comment['comment_type'], array('pingback', 'trackback'))) { return $comment; } if(!preg_match('/[一-龥]/u', $comment['comment_content'])) { wp_die("评论内容不合法！"); } return $comment; } public function setKeywords($keywords) { $this->keywords = explode(",", $keywords); } public function blockSomeKeywords($comment) { foreach ($this->keywords as $keyword) { if (stripos($comment["comment_content"], $keyword) !== false) { wp_die("评论内容不合法！"); } } return $comment; } } 